{% extends "base.html" %}
{% load static %}

{% block meta %}
<title>Home - Souline</title>
<style>
  /* Hero gradient background */
  .hero-section {
    background: linear-gradient(135deg, #446178 0%, #91C4C3 100%);
  }
</style>
{% endblock meta %}

{% block content %}
{% include "header.html" %}

<!-- Hero Section -->
<div class="hero-section text-[#FFFBF0] py-16 px-4 text-center mb-12">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl md:text-5xl font-bold mb-4" style="text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);">Welcome to Souline</h1>
    <p class="text-xl md:text-2xl mb-8 opacity-95">Your best guide to find Yoga & Pilates studios, connect with communities, and enhance your well-being.</p>
    <a href="#studios-section" 
       class="inline-block px-8 py-3.5 bg-[#FFA04D] text-[#FFFBF0] rounded-full font-semibold text-lg hover:bg-[#ff8c2e] hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-xl">
      Start Your Journey
    </a>
    <div class="mt-8 animate-bounce">
      <p class="text-white text-3xl">‚Üì</p>
    </div>
  </div>
</div>

<!-- Studios Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="studios-section">
  <!-- Section Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-3xl md:text-4xl font-semibold text-[#446178]">
        {% if user.is_authenticated and user.profile.kota %}
          Studios Near You
        {% else %}
          Featured Studios
        {% endif %}
      </h2>
      <p class="text-lg text-[#FFA04D] mt-1">
        {% if user.is_authenticated and user.profile.kota %}
          Discover yoga & pilates studios in {{ user.profile.kota }}
        {% else %}
          Discover amazing yoga & pilates studios in Jabodetabek
        {% endif %}
      </p>
    </div>
    <a href="{% url 'studio:show_studio' %}" 
       class="px-6 py-2.5 bg-[#B4DEBD] text-[#446178] rounded-full font-medium hover:bg-[#91C4C3] hover:-translate-y-0.5 hover:shadow-md transition-all duration-300">
      View All Studios
    </a>
  </div>

  <!-- Carousel -->
  <div class="carousel-container relative py-4" data-carousel="main">
    <!-- Left Arrow -->
    <button class="nav-btn hidden absolute top-1/2 left-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
            onclick="scrollCarousel('main', -1)" 
            aria-label="Scroll left">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <!-- Cards Container -->
    <div class="cards-wrapper flex gap-6 overflow-x-auto p-4">
      {% for studio in studios %}
        <div class="studio-card min-w-[320px] max-w-[320px] bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 flex-shrink-0">
          <img src="{{ studio.thumbnail }}" alt="{{ studio.nama_studio }}" loading="lazy" class="w-full h-48 object-cover bg-gray-100">
          <div class="p-5">
            <h3 class="text-xl font-semibold text-[#446178] mb-2 leading-tight">{{ studio.nama_studio }}</h3>
            <p class="text-[#91C4C3] font-medium text-sm mb-1">üìç {{ studio.area }}, {{ studio.get_kota_display }}</p>
            <p class="text-gray-600 text-sm mb-1 leading-relaxed">üìç {{ studio.alamat }}</p>
            <p class="text-gray-600 text-sm mb-3 leading-relaxed">üìû {{ studio.nomor_telepon }}</p>
            <a href="{{ studio.gmaps_link }}" target="_blank" rel="noopener" 
               class="inline-block mt-2 px-4 py-2 bg-[#FFA04D] text-white rounded-lg text-sm font-medium hover:bg-[#ff8c2e] hover:scale-105 hover:shadow-md transition-all duration-300">
              View on Google Maps ‚Üí
            </a>
          </div>
        </div>
      {% empty %}
        <div class="w-full text-center py-16 bg-white rounded-2xl m-4">
          <p class="text-gray-400 text-lg">No studios available at the moment.</p>
        </div>
      {% endfor %}
    </div>
    
    <!-- Right Arrow -->
    <button class="nav-btn hidden absolute top-1/2 right-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
            onclick="scrollCarousel('main', 1)" 
            aria-label="Scroll right">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
</div>

<!-- Resources Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="resources-section">
  <!-- Section Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-3xl md:text-4xl font-semibold text-[#446178]">
        Resources
      </h2>
      <p class="text-lg text-[#FFA04D] mt-1">
        Description Placeholder
      </p>
    </div>
  </div>

    <!-- Content Placeholder (lanjut disini untuk Resources di halaman main) -->
    
</div>

<!-- Timeline Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="timeline-section">
  <!-- Section Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-3xl md:text-4xl font-semibold text-[#446178]">
        Timeline
      </h2>
      <p class="text-lg text-[#FFA04D] mt-1">
        Description Placeholder
      </p>
    </div>
  </div>

  <!-- Timeline Content -->
  <div class="max-w-3xl mx-auto w-full">
    {% if user.is_authenticated %}
      <form id="postForm" method="post" enctype="multipart/form-data"
            action="{% url 'timeline:create' %}"
            class="bg-card-bg p-5 rounded-2xl shadow-md space-y-3">
        {% csrf_token %}
        {{ post_form.text }}
        <div class="flex flex-col sm:flex-row gap-3">
          {{ post_form.image }}
          {{ post_form.video_url }}
        </div>
        <button type="submit"
                class="bg-highlight-orange text-white font-semibold px-5 py-2 rounded-lg hover:bg-[#ff8c2e] transition">
          Post
        </button>
        <div id="postErrors" class="text-red-600 text-sm mt-2 hidden"></div>
      </form>
    {% else %}
      <p class="text-center text-dark-blue">
        Please <a href="{% url 'users:login' %}" class="text-highlight-orange underline">log in</a> to post.
      </p>
    {% endif %}

    <!-- Timeline Feed -->
    <section id="posts" class="mt-8 space-y-6">
      {% for post in posts %}
        {% include "timeline/_post.html" %}
      {% empty %}
        <p class="text-center text-dark-blue">No posts yet. Be the first!</p>
      {% endfor %}
    </section>

    <!-- Pagination -->
    <div class="flex justify-center mt-8 space-x-4 text-dark-blue font-medium">
      {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}" class="hover:text-highlight-orange">‚Üê Prev</a>
      {% endif %}
      <span>Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>
      {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}" class="hover:text-highlight-orange">Next ‚Üí</a>
      {% endif %}
    </div>
  </div>

  <script src="{% static 'timeline/timeline.js' %}"></script>
</div>

<!-- Events Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="events-section">
  <!-- Section Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-3xl md:text-4xl font-semibold text-[#446178]">
        Events
      </h2>
      <p class="text-lg text-[#FFA04D] mt-1">
        Description Placeholder
      </p>
    </div>
  </div>

    <!-- Content Placeholder (lanjut disini untuk Events di halaman main) -->
    
</div>

<!-- Sportswear Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="sportswear-section">
  <!-- Section Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h2 class="text-3xl md:text-4xl font-semibold text-[#446178]">
        Sportswear
      </h2>
      <p class="text-lg text-[#FFA04D] mt-1">
        Description Placeholder
      </p>
    </div>
  </div>

    <!-- Content Placeholder (lanjut disini untuk Sportswear di halaman main) -->
    
</div>

<script>
  function scrollCarousel(carouselId, direction) {
    const carousel = document.querySelector(`[data-carousel="${carouselId}"]`);
    const wrapper = carousel.querySelector('.cards-wrapper');
    const cardWidth = 320 + 24;
    const scrollAmount = cardWidth * 2;
    
    wrapper.scrollBy({
      left: direction * scrollAmount,
      behavior: 'smooth'
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    const carousels = document.querySelectorAll('.carousel-container');
    
    carousels.forEach(carousel => {
      const wrapper = carousel.querySelector('.cards-wrapper');
      const leftBtn = carousel.querySelector('.nav-btn:first-of-type');
      const rightBtn = carousel.querySelector('.nav-btn:last-of-type');
      
      function updateButtons() {
        const canScrollLeft = wrapper.scrollLeft > 10;
        const canScrollRight = wrapper.scrollLeft < (wrapper.scrollWidth - wrapper.clientWidth - 10);
        
        leftBtn.classList.toggle('hidden', !canScrollLeft);
        rightBtn.classList.toggle('hidden', !canScrollRight);
      }
      
      updateButtons();
      wrapper.addEventListener('scroll', updateButtons);
      window.addEventListener('resize', updateButtons);
    });
  });

  document.addEventListener('keydown', function(e) {
    const focusedCarousel = document.querySelector('.carousel-container:hover');
    if (!focusedCarousel) return;
    
    const carouselId = focusedCarousel.getAttribute('data-carousel');
    
    if (e.key === 'ArrowLeft') {
      scrollCarousel(carouselId, -1);
    } else if (e.key === 'ArrowRight') {
      scrollCarousel(carouselId, 1);
    }
  });
</script>

{% endblock content %}