{% extends "base.html" %}

{% block meta %}
<title>Studio List - Souline</title>
{% endblock meta %}

{% block content %}
{% include "header.html" %}

<!-- Main Content Container -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-[#446178] mb-2">Discover Your Perfect Studio</h1>
    <p class="text-lg text-[#FFA04D]">Find your space to move and breathe</p>
  </div>

  <!-- Admin Action Button (Only visible to staff/superuser) -->
  {% if user.is_staff or user.is_superuser %}
    <div class="mb-6">
      <a href="{% url 'studio:add_studio' %}" 
         class="inline-block px-6 py-3 bg-[#FFA04D] text-white rounded-lg hover:bg-[#ff8c2e] transition-all duration-300 font-medium shadow-md hover:shadow-lg">
        + Add New Studio
      </a>
    </div>
  {% endif %}

  {% if has_user_city %}
    <!-- User's City Section (Shows first if user has selected a city) -->
    <section class="mb-12">
      <div class="mb-4">
        <h2 class="text-3xl font-semibold text-[#446178] flex items-center">
          <span class="mr-2">📍</span>
          Studios in {{ user_kota }} <span class="ml-2 text-sm font-normal text-[#91C4C3]">(Your City)</span>
        </h2>
      </div>
      
      <!-- Horizontal Scrolling Carousel -->
      <div class="carousel-container relative py-4" data-carousel="user-city">
        <!-- Left Scroll Button (Hidden by default, shown by JS when scrollable) -->
        <button class="hidden absolute top-1/2 left-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                onclick="scrollCarousel('user-city', -1)" 
                aria-label="Scroll left">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        
        <!-- Studio Cards Wrapper (Horizontal scroll container) -->
        <div class="cards-wrapper flex gap-6 overflow-x-auto p-4">
          <!-- Loop through studios in user's city -->
          {% for studio in user_kota_studios %}
            <!-- Individual Studio Card -->
            <div class="studio-card min-w-[320px] max-w-[320px] bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 flex-shrink-0">
              <img src="{{ studio.thumbnail }}" alt="{{ studio.nama_studio }}" loading="lazy" class="w-full h-48 object-cover bg-gray-100">
              <div class="p-5">
                <h3 class="text-xl font-semibold text-[#446178] mb-2 leading-tight">{{ studio.nama_studio }}</h3>
                <p class="text-[#91C4C3] font-medium text-sm mb-1">📍 {{ studio.area }}, {{ studio.get_kota_display }}</p>
                <p class="text-gray-600 text-sm mb-1 leading-relaxed">📍 {{ studio.alamat }}</p>
                <p class="text-gray-600 text-sm mb-3 leading-relaxed">📞 {{ studio.nomor_telepon }}</p>
                <a href="{{ studio.gmaps_link }}" target="_blank" rel="noopener" 
                   class="inline-block mt-2 px-4 py-2 bg-[#FFA04D] text-white rounded-lg text-sm font-medium hover:bg-[#ff8c2e] hover:scale-105 hover:shadow-md transition-all duration-300">
                  View on Google Maps →
                </a>
              </div>
            </div>
          {% empty %}
            <!-- Empty State -->
            <div class="w-full text-center py-16 bg-white rounded-2xl m-4">
              <p class="text-gray-400 text-lg">No studios available in your city yet.</p>
            </div>
          {% endfor %}
        </div>
        
        <!-- Right Scroll Button (Hidden by default, shown by JS when scrollable) -->
        <button class="hidden absolute top-1/2 right-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                onclick="scrollCarousel('user-city', 1)" 
                aria-label="Scroll right">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Other Cities Section (After user's city) -->
    {% for city_data in cities_with_studios %}
      <section class="mb-12">
        <div class="mb-4">
          <h2 class="text-3xl font-semibold text-[#446178]">Studios in {{ city_data.name }}</h2>
        </div>
        
        <div class="carousel-container relative py-4" data-carousel="{{ city_data.name }}">
          <button class="hidden absolute top-1/2 left-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                  onclick="scrollCarousel('{{ city_data.name }}', -1)" 
                  aria-label="Scroll left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          
          <div class="cards-wrapper flex gap-6 overflow-x-auto p-4">
            {% for studio in city_data.studios %}
              <div class="studio-card min-w-[320px] max-w-[320px] bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 flex-shrink-0">
                <img src="{{ studio.thumbnail }}" alt="{{ studio.nama_studio }}" loading="lazy" class="w-full h-48 object-cover bg-gray-100">
                <div class="p-5">
                  <h3 class="text-xl font-semibold text-[#446178] mb-2 leading-tight">{{ studio.nama_studio }}</h3>
                  <p class="text-[#91C4C3] font-medium text-sm mb-1">📍 {{ studio.area }}, {{ studio.get_kota_display }}</p>
                  <p class="text-gray-600 text-sm mb-1 leading-relaxed">📍 {{ studio.alamat }}</p>
                  <p class="text-gray-600 text-sm mb-3 leading-relaxed">📞 {{ studio.nomor_telepon }}</p>
                  <a href="{{ studio.gmaps_link }}" target="_blank" rel="noopener" 
                     class="inline-block mt-2 px-4 py-2 bg-[#FFA04D] text-white rounded-lg text-sm font-medium hover:bg-[#ff8c2e] hover:scale-105 hover:shadow-md transition-all duration-300">
                    View on Google Maps →
                  </a>
                </div>
              </div>
            {% empty %}
              <div class="w-full text-center py-16 bg-white rounded-2xl m-4">
                <p class="text-gray-400 text-lg">No studios available in {{ city_data.name }} yet.</p>
              </div>
            {% endfor %}
          </div>
          
          <button class="hidden absolute top-1/2 right-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                  onclick="scrollCarousel('{{ city_data.name }}', 1)" 
                  aria-label="Scroll right">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </section>
    {% endfor %}
  {% else %}
    <!-- All Cities Section (When user has no city selected) -->
    {% for city_data in cities_with_studios %}
      <section class="mb-12">
        <div class="mb-4">
          <h2 class="text-3xl font-semibold text-[#446178]">Studios in {{ city_data.name }}</h2>
        </div>
        
        <div class="carousel-container relative py-4" data-carousel="{{ city_data.name }}">
          <button class="hidden absolute top-1/2 left-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                  onclick="scrollCarousel('{{ city_data.name }}', -1)" 
                  aria-label="Scroll left">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          
          <div class="cards-wrapper flex gap-6 overflow-x-auto p-4">
            {% for studio in city_data.studios %}
              <div class="studio-card min-w-[320px] max-w-[320px] bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 flex-shrink-0">
                <img src="{{ studio.thumbnail }}" alt="{{ studio.nama_studio }}" loading="lazy" class="w-full h-48 object-cover bg-gray-100">
                <div class="p-5">
                  <h3 class="text-xl font-semibold text-[#446178] mb-2 leading-tight">{{ studio.nama_studio }}</h3>
                  <p class="text-[#91C4C3] font-medium text-sm mb-1">📍 {{ studio.area }}, {{ studio.get_kota_display }}</p>
                  <p class="text-gray-600 text-sm mb-1 leading-relaxed">📍 {{ studio.alamat }}</p>
                  <p class="text-gray-600 text-sm mb-3 leading-relaxed">📞 {{ studio.nomor_telepon }}</p>
                  <a href="{{ studio.gmaps_link }}" target="_blank" rel="noopener" 
                     class="inline-block mt-2 px-4 py-2 bg-[#FFA04D] text-white rounded-lg text-sm font-medium hover:bg-[#ff8c2e] hover:scale-105 hover:shadow-md transition-all duration-300">
                    View on Google Maps →
                  </a>
                </div>
              </div>
            {% empty %}
              <div class="w-full text-center py-16 bg-white rounded-2xl m-4">
                <p class="text-gray-400 text-lg">No studios available in {{ city_data.name }} yet.</p>
              </div>
            {% endfor %}
          </div>
          
          <button class="hidden absolute top-1/2 right-2 -translate-y-1/2 w-10 h-10 bg-[#FFF7DD]/95 backdrop-blur-md border-2 border-[#446178] text-[#446178] rounded-full flex items-center justify-center cursor-pointer z-10 opacity-70 hover:bg-[#446178] hover:text-[#FFF7DD] hover:opacity-100 hover:scale-110 active:scale-95 transition-all duration-300 shadow-lg" 
                  onclick="scrollCarousel('{{ city_data.name }}', 1)" 
                  aria-label="Scroll right">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </section>
    {% endfor %}
  {% endif %}
</div>

<!-- Carousel Control Scripts -->
<script>
  // Smooth scroll function for carousel navigation
  function scrollCarousel(carouselId, direction) {
    const carousel = document.querySelector(`[data-carousel="${carouselId}"]`);
    const wrapper = carousel.querySelector('.cards-wrapper');
    const cardWidth = 320 + 24; // Card width + gap
    const scrollAmount = cardWidth * 2; // Scroll 2 cards at a time
    
    wrapper.scrollBy({
      left: direction * scrollAmount,
      behavior: 'smooth'
    });
  }

  // Initialize carousels on page load
  document.addEventListener('DOMContentLoaded', function() {
    const carousels = document.querySelectorAll('.carousel-container');
    
    carousels.forEach(carousel => {
      const wrapper = carousel.querySelector('.cards-wrapper');
      const leftBtn = carousel.querySelector('button:first-of-type');
      const rightBtn = carousel.querySelector('button:last-of-type');
      
      // Show/hide navigation buttons based on scroll position
      function updateButtons() {
        const canScrollLeft = wrapper.scrollLeft > 10;
        const canScrollRight = wrapper.scrollLeft < (wrapper.scrollWidth - wrapper.clientWidth - 10);
        
        leftBtn.classList.toggle('hidden', !canScrollLeft);
        rightBtn.classList.toggle('hidden', !canScrollRight);
      }
      
      // Update buttons on scroll and resize
      updateButtons();
      wrapper.addEventListener('scroll', updateButtons);
      window.addEventListener('resize', updateButtons);
    });
  });

  // Keyboard navigation (Arrow keys)
  document.addEventListener('keydown', function(e) {
    const focusedCarousel = document.querySelector('.carousel-container:hover');
    if (!focusedCarousel) return;
    
    const carouselId = focusedCarousel.getAttribute('data-carousel');
    
    if (e.key === 'ArrowLeft') {
      scrollCarousel(carouselId, -1);
    } else if (e.key === 'ArrowRight') {
      scrollCarousel(carouselId, 1);
    }
  });
</script>
{% endblock content %}
