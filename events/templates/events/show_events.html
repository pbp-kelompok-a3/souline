{% extends 'base.html' %}
{% block title %}Events | Souline{% endblock title %}

{% block content %}
{% include "header.html" %}

<div class="min-h-screen bg-[#FFF9F1] flex flex-col items-center py-16 px-6">

  <!-- Header -->
  <div class="w-full max-w-6xl flex flex-col md:flex-row justify-between items-start md:items-center mb-12">
    <div>
      <h1 class="text-4xl font-bold text-[#446178] mb-2">Events</h1>
      <p class="text-[#F48C06] mt-2 text-lg font-medium">Take a moment to feel your flow</p>
    </div>

    <!-- Filter dropdown -->
    <div class="relative mt-6 md:mt-0">
      <select id="filter-select"
        class="appearance-none border border-[#F48C06]/30 bg-white rounded-full px-8 py-3 text-gray-400 text-left font-medium focus:ring-2 focus:ring-[#F48C06] focus:outline-none shadow-sm transition hover:shadow-md cursor-pointer">
        <option value="">All Upcoming Events</option>
        <option value="soon">Upcoming Soon (within 7 days)</option>
        <option value="later">Coming Later (after 7 days)</option>
      </select>
      
      <!-- Custom dropdown icon -->
      <svg class="w-5 h-5 text-[#F48C06] absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none"
        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </div>

  <!-- Events container -->
  <div id="events-container" class="event-wrapper max-w-6xl justify-start md:justify-center">
    {% if events %}
      {% for event in events %}
        <div class="event-card w-80 p-6 flex flex-col items-center text-center">
          {% if event.poster %}
            <img src="{{ event.poster.url }}" alt="{{ event.name }}" class="rounded-t-xl w-full h-48 object-cover">
          {% else %}
            <div class="h-48 flex items-center justify-center bg-gray-100 text-gray-400">
              No image
            </div>
          {% endif %}


          <h2 class="font-semibold text-xl text-[#2E4057]">{{ event.name }}</h2>
          <p class="event-date mt-1">{{ event.date|date:"d F Y" }}</p>
          <p class="text-gray-600 mt-3 text-sm text-center">{{ event.description|truncatechars:100 }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-gray-500 italic text-center w-full">No upcoming events yet.</p>
    {% endif %}
  </div>

  <!-- Add Event Button (admin only) -->
  {% if request.user.is_staff %}
  <div class="flex justify-start w-full max-w-6xl mt-14">
    <a href="{% url 'events:add_event' %}" class="add-btn shadow-md">
       + Add Event
    </a>
  </div>
  {% endif %}

<!-- AJAX -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const select = document.getElementById('filter-select');
  const container = document.getElementById('events-container');

  select.addEventListener('change', function() {
    const filterType = this.value;
    fetch(`/events/json/${filterType || ''}`)
      .then(response => response.json())
      .then(data => {
        container.innerHTML = '';

        if (data.length === 0) {
          container.innerHTML = '<p class="text-gray-500 italic text-center w-full">No upcoming events found.</p>';
          return;
        }

        data.forEach(event => {
          const card = `
            <div class="event-card w-80 p-6 flex flex-col items-center text-center">
              ${event.poster ? `<img src="${event.poster}" class="event-poster mb-4">`
                              : `<div class="event-side flex items-center justify-center mb-4 text-gray-400">No Image</div>`}
              <h2 class="font-semibold text-xl text-[#2E4057]">${event.name}</h2>
              <p class="event-date mt-1">${event.date}</p>
              <p class="text-gray-600 mt-3 text-sm text-center">${event.description}</p>
            </div>`;
          container.insertAdjacentHTML('beforeend', card);
        });
      });
  });
});
</script>

{% include "footer.html" %}
{% endblock %}
