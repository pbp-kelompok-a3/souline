{% extends 'base.html' %}
{% load static %}
{% block content %}
{% include "header.html" %}

<div class="bg-[#FFF9F1] min-h-screen py-12 px-6">
  <div class="max-w-5xl mx-auto bg-[#FFF3D9] p-10 rounded-3xl shadow-md">
    <p class="text-[#F48C06] text-lg mb-8 font-medium">Take a moment to feel your flow</p>

    <!-- FORM -->
    <form id="eventForm" method="POST" enctype="multipart/form-data" class="flex flex-col md:flex-row gap-10">
      {% csrf_token %}

      <!-- Upload Poster -->
      <div class="flex flex-col items-center justify-center w-[300px] h-[350px] border-2 border-dashed border-gray-300 rounded-2xl hover:border-[#F48C06] transition relative bg-white">
        {% if form.instance.poster %}
          <img id="posterPreview" src="{{ form.instance.poster.url }}" alt="{{ form.instance.name }}"
               class="absolute inset-0 w-full h-full object-cover rounded-2xl">
          <button type="button"
                  onclick="clearPoster()"
                  class="absolute bottom-3 right-3 bg-[#F48C06] text-white px-3 py-1 rounded-md text-xs shadow hover:bg-[#d97706] transition">
            Clear
          </button>
        {% else %}
          <div id="posterPreview" class="flex flex-col items-center justify-center h-full">
            <span class="text-3xl text-gray-400">+</span>
            <span class="text-gray-400 mt-2">Upload Poster</span>
          </div>
        {% endif %}

        <input type="file" name="poster" id="id_poster" accept="image/*" class="hidden" onchange="previewPoster(event)">
        <label for="id_poster" class="absolute inset-0 cursor-pointer"></label>
      </div>

      <!-- Event Info -->
      <div class="flex flex-col justify-start w-full space-y-5">
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Name</label>
          {{ form.name }}
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Date</label>
          {{ form.date }}
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Description</label>
          {{ form.description }}
        </div>
      </div>
    </form>

    <!-- Buttons -->
    <div class="flex justify-end mt-10 space-x-4">
      <!-- SAVE -->
      <button type="submit" form="eventForm"
        class="bg-[#F48C06] text-white px-6 py-2 rounded-md hover:bg-[#d97706] transition">
        Save
      </button>

      <!-- CANCEL -->
      <a href="{% url 'events:event_list' %}"
        class="bg-white text-[#2E4057] border border-[#2E4057] px-6 py-2 rounded-md hover:bg-[#2E4057] hover:text-white transition">
        Cancel
      </a>
    </div>
  </div>
</div>

<script>
function previewPoster(event) {
  const input = event.target;
  const preview = document.getElementById('posterPreview');
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = e => {
      preview.innerHTML = '';
      const img = document.createElement('img');
      img.src = e.target.result;
      img.classList.add('absolute', 'inset-0', 'w-full', 'h-full', 'object-cover', 'rounded-2xl');
      preview.appendChild(img);
    };
    reader.readAsDataURL(input.files[0]);
  }
}

function clearPoster() {
  const preview = document.getElementById('posterPreview');
  const input = document.getElementById('id_poster');
  input.value = '';
  preview.innerHTML = `
    <div class="flex flex-col items-center justify-center h-full">
      <span class="text-3xl text-gray-400">+</span>
      <span class="text-gray-400 mt-2">Upload Poster</span>
    </div>`;
}
</script>

<style>
  input[type="text"],
  input[type="date"],
  textarea {
    width: 100%;
    border-radius: 0.75rem;
    border: 1px solid #e5e7eb;
    padding: 0.75rem 1rem;
    background-color: #fff;
    font-size: 1rem;
    color: #374151;
    outline: none;
  }

  input[type="text"]:focus,
  input[type="date"]:focus,
  textarea:focus {
    border-color: #f48c06;
    box-shadow: 0 0 0 2px rgba(244, 140, 6, 0.25);
  }
</style>

{% include "footer.html" %}
{% endblock %}
